<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2024-11-11" />

<title>Poster figures</title>

<script src="poster_figures_files/header-attrs-2.27/header-attrs.js"></script>
<script src="poster_figures_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="poster_figures_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="poster_figures_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="poster_figures_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="poster_figures_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="poster_figures_files/navigation-1.1/tabsets.js"></script>
<link href="poster_figures_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="poster_figures_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">Poster figures</h1>
<h4 class="date">2024-11-11</h4>

</div>


<pre class="r"><code>my_theme &lt;- function(base_size = 20) {
  ggplot2::theme_minimal(base_size = base_size) +
            ggplot2::theme(panel.background = ggplot2::element_rect(fill = &quot;#fafafa&quot;, color = NA),
                  legend.position = &quot;bottom&quot;,
                  legend.title.position = &quot;top&quot;, 
                  legend.title = ggplot2::element_text(hjust = 0.5),
                  legend.frame = ggplot2::element_rect(color = &quot;black&quot;, linewidth = 0.4),
                  legend.key.height = grid::unit(0.75, &quot;lines&quot;),
                  axis.text.y = element_text_first_line())
}

ggplot2::theme_set(my_theme())</code></pre>
<pre class="r"><code>datasets &lt;- list(cdr = CDR(),
                 bt = BT(),
                 osi = OSI(),
                 era5 = ERA5()
)
which_dataset &lt;- &quot;cdr&quot;</code></pre>
<pre class="r"><code>extent_daily &lt;- datasets |&gt;
  lapply(extent) |&gt;
  lapply(\(x) ReadNetCDF(x, &quot;aice&quot;)) |&gt;
  rbindlist(idcol = &quot;dataset&quot;) |&gt;
  _[, let(lon = NULL, lat = NULL)]</code></pre>
<pre class="r"><code>extent_climatology &lt;- extent_daily |&gt;  
  copy() |&gt;
  _[aice == 0, aice := NA] |&gt; 
  _[!(month(time) == 2 &amp; mday(time) == 29)] |&gt; 
  _[, time := update(time, year = 2001)] |&gt; 
  _[, median_ci(aice), by = .(time, dataset)] </code></pre>
<pre class="r"><code>hindcast_extent &lt;- rbind(S1 = readRDS(here::here(&quot;data/derived/S1_hindcast_extent.Rds&quot;)),
                         S2 = readRDS(here::here(&quot;data/derived/S2_hindcast_extent.Rds&quot;)), 
                         idcol = &quot;model&quot;) |&gt;
  _[, model := relevel(factor(model), &quot;S2&quot;)] |&gt; 
  _[, lag := as.numeric(as.Date(time) - forecast_time)] |&gt; 
  _[lag &gt; 0] |&gt; 
  _[!(month(forecast_time) == 1 &amp; member == 7 &amp; model == &quot;S1&quot;)]  # This member is wrong</code></pre>
<pre class="r"><code>hindcast_extent |&gt; 
  _[, median_ci(aice), by = .(forecast_time = update(forecast_time, year = 2001),
                              lag = as.numeric(as.Date(time) - forecast_time),
                              model)] |&gt;
  _[, time := forecast_time + lag] |&gt;
  _[, time2 := update(time, year = 2001)] |&gt;
  _[, month := lubridate::month(forecast_time, label = TRUE)] |&gt;
  # _[]
  ggplot(aes(time2, mid)) +
  geom_line(data = extent_climatology[dataset == which_dataset], 
            aes(x = as.Date(time),
                group = dataset),
            linewidth = 1) + 
  geom_line(aes(color = month, group = interaction(forecast_time, time != time2)),
            linewidth = 1) +
  
  geom_point(data = \(x) x[mday(time) == 2, .SD[which.max(lag)], by = .(forecast_time, model)], 
             aes(fill = month), 
             shape = 24, size = 4) +
  
  geom_point(data = \(x) x[lag == 1], aes(fill = month), 
             shape = 21, size = 4) +
  
  scale_x_date(NULL, date_breaks = &quot;1 month&quot;, 
               date_labels = &quot;%b&quot;, expand = c(0, 0)) +
  scale_y_continuous(NULL, labels = labels_extent) +
  scale_color_manual(values = cetcolor::cet_pal(12, name = &quot;c2&quot;), 
                     aesthetics = c(&quot;fill&quot;, &quot;color&quot;), guide = &quot;none&quot;) +
  facet_wrap(~ model, ncol = 1) +
  tag_facets() </code></pre>
<div class="figure">
<img src="poster_figures_files/figure-html/fig-hindcast-extent-1.png" alt="Median sea ice extent for al hindcasts initialised the first of the month for +S2 and +S1 in colours representing the start month. In black, the median sea ice extent of +CDR." width="1475.84" />
<p class="caption">
Median sea ice extent for al hindcasts initialised the first of the
month for +S2 and +S1 in colours representing the start month. In black,
the median sea ice extent of +CDR.
</p>
</div>
<pre class="r"><code>climatologies &lt;- c(datasets,
                   S2 = S2_reanalysis()) |&gt;
  lapply(\(x) climatology(x) |&gt;
           cdo_ymonmean() |&gt; 
           cdo_execute()
  ) |&gt;
  lapply(\(x) ReadNetCDF(x, &quot;aice&quot;)) |&gt;
  rbindlist(idcol = &quot;model&quot;) </code></pre>
<pre class="r"><code>zeropad &lt;- function(x, n = 2) formatC(x, width = 2, flag = &quot;0&quot;)
monnb &lt;- function(d) { lt &lt;- as.POSIXlt(as.Date(d, origin=&quot;1900-01-01&quot;)); 
lt$year*12 + lt$mon } 
mondf &lt;- function(d1, d2) { monnb(d2) - monnb(d1) }

months &lt;- 1:12
hindcast_clim &lt;- lapply(setNames(months, months), \(month) {
  here::here(glue::glue(&quot;data/derived/hindcast_climatology/mo_aice_1981{zeropad(month)}01_mean.nc&quot;)) |&gt; 
    ReadNetCDF(&quot;aice&quot;)
}) |&gt; 
  rbindlist(idcol = &quot;forecast_month&quot;) |&gt; 
  _[, forecast_month := as.numeric(forecast_month)] |&gt; 
  _[, forecast_time := lubridate::make_datetime(1981, forecast_month, 01)] |&gt; 
  _[, time := lubridate::floor_date(time, &quot;month&quot;)] |&gt; 
  _[, lag := mondf(forecast_time, time)] |&gt; 
  _[lag == 0] |&gt; 
  _[, time2 := update(time, year = 2000)]


obs_clim &lt;- CDR() |&gt; 
  climatology() |&gt; 
  ReadNetCDF(c(obs = &quot;aice&quot;)) |&gt; 
  setnames(&quot;time&quot;, &quot;time2&quot;)

hindcast_clim &lt;- hindcast_clim |&gt; 
  merge(obs_clim) |&gt; 
  _[, month := month(time)] </code></pre>
<pre class="r"><code>hindcast_clim |&gt; 
  # _[time == time[1]] |&gt; 
  ggplot(aes(xgrid, ygrid)) +
  geom_contour_fill(aes(z = aice - obs, fill = after_stat(level)), 
                    breaks = AnchorBreaks(binwidth = 0.1, exclude = 0)) +
  scale_fill_divergent_discretised(NULL,
                                   low = scales::muted(&quot;red&quot;),
                                   high = scales::muted(&quot;blue&quot;)) +
  geomcoord_antarctica +
  geom_antarctica_fill +
  facet_wrap(~ lubridate::month(time, label = TRUE)) +
  wide_legend +
  tag_facets() +
  theme(panel.ontop = TRUE, 
        panel.background = element_blank(),
        panel.grid = element_line(colour = alpha(&quot;gray50&quot;, 0.5), linewidth = 0.4))</code></pre>
<div class="figure">
<img src="poster_figures_files/figure-html/fig-bias-1.png" alt="1-month lag +S2 forecast bias compared with NSIDC." width="1475.84" />
<p class="caption">
1-month lag +S2 forecast bias compared with NSIDC.
</p>
</div>
<p><span class="citation">@fig-bias</span> shows the difference in
monthly mean sea ice concentrations between +CDR and +S2 reanalysis.
From October to May, the model underestimates sea ice concentrations
pretty much everywhere there is ice except for the deep Weddell Sea in
April and May, where sea ice concentrations saturate to 1. In winter,
the differences are mostly on the sea ice edge, with slight positive
bias in XXX and negative bias around the Indian Ocean sector.</p>
<div id="rmse" class="section level3">
<h3>RMSE</h3>
<p>To study +S2 forecasts quantitatively, we compute error measures for
all hindcasts started on the 1st of every month.</p>
<pre class="r"><code>errors &lt;- rbind(
  readRDS(here::here(&quot;data/derived/rmse.Rds&quot;)) |&gt;
    _[version != &quot;S1&quot;], 
  readRDS(here::here(&quot;data/derived/iiee.Rds&quot;))
) |&gt;
  _[value &lt; 0.01, value := NA] |&gt; 
  _[value &gt; 3e13, value := NA] |&gt; 
  _[, time := as.Date(time)] |&gt; 
  _[, lag := as.numeric(time - time_forecast)] |&gt; 
  _[lag &gt; 0] |&gt; 
  _[!(month(time_forecast) == 1 &amp; member == &quot;07&quot; &amp; version == &quot;S1&quot;)]  # This member is wrong</code></pre>
<pre class="r"><code>month_from_lag &lt;- function(day = 1, step = 2) {
  force(day)
  force(step)
  function(x) {
    unique(x[, .(lag, month)])[, time := make_date(month = month, day = 1) + lag] |&gt; 
      _[mday(time) == day, .(lag, month, 
                             month2 = lubridate::month(time, label = TRUE)
      )] |&gt; 
      _[, .SD[((seq_len(.N) + 1) %% step) == 0], by = month]
  }
}

errors |&gt; 
  _[measure == &quot;rmse&quot;] |&gt;
  _[obs_dataset ==  which_dataset] |&gt;
  _[, median_ci(value), 
    by = .(lag, version, measure, month(time_forecast), obs_dataset)] |&gt; 
  _[version == &quot;persistence&quot;, version := obs_dataset] |&gt; 
  ggplot(aes(lag, mid)) +
  
  geom_vline(data = month_from_lag(1, 1), aes(xintercept = lag), 
             colour = &quot;gray50&quot;, linewidth = 0.1) +
  
  geom_text(data = month_from_lag(15, 1), aes(y = Inf, label = month2),
            size = 2.5,
            vjust = 1) +
  
  geom_text(data = month_from_lag(1, 1), aes(y = -Inf, label = lag), 
            size = 2.5,
            vjust = 0) +
  
  
  geom_ribbon(aes(ymin = low, 
                  ymax = high, 
                  color = version, 
                  fill = version,
                  group = interaction(obs_dataset, version)),
              alpha = 0.1) +
  geom_line(aes(color = version, group = interaction(obs_dataset, version)), linewidth = 1) +
  scale_x_continuous(breaks = NULL, expand = c(0, 0)) +
  labs(y = &quot;RMSE&quot;, 
       x = &quot;Lag&quot;) +
  scale_color_models +
  scale_fill_models +
  #   scale_color_models +
  #   scale_fill_models +
  facet_wrap(~ month, labeller = labeller(month = labels_month)) </code></pre>
<div class="figure">
<img src="poster_figures_files/figure-html/fig-rmse-1.png" alt="Median and 95% coverage of sea ice concentration anomalies RMSE as a function of forecast lag for all forecast initialised on the first of each month compared with a reference forecast of persistence of anomalies." width="1475.84" />
<p class="caption">
Median and 95% coverage of sea ice concentration anomalies RMSE as a
function of forecast lag for all forecast initialised on the first of
each month compared with a reference forecast of persistence of
anomalies.
</p>
</div>
</div>
<div id="comparison-with-s1" class="section level3">
<h3>Comparison with S1</h3>
<pre class="r"><code>t_test &lt;- function(x, y, ...) {
  
  test &lt;- t.test(x, y, ...)
  
  list(low = test[[&quot;conf.int&quot;]][1],
       high = test[[&quot;conf.int&quot;]][2], 
       estimate = -diff(test$estimate), 
       p.value = test[[&quot;p.value&quot;]]
  )
}

max_lag &lt;- errors[version == &quot;S1&quot;, max(lag)]

dif &lt;- errors |&gt; 
  na.omit() |&gt; 
  _[obs_dataset == which_dataset] |&gt;
  _[measure == &quot;iiee&quot;] |&gt; 
  _[version != &quot;persistence&quot;] |&gt; 
  _[lag &lt;= max_lag] |&gt; 
  dcast(time + time_forecast + member + lag ~ version, value.var = &quot;value&quot;) |&gt; 
  _[, t_test(na.omit(S1), na.omit(S2)), 
    by = .(lag, month(time_forecast))] |&gt; 
  _[p.value &gt; 0.01] |&gt; 
  _[, .SD[which.min(lag)], by = month] |&gt; 
  _[order(month), .(month, lag)]

labels_month_significant &lt;- setNames(paste0(month.abb, &quot; (&quot;, dif$lag, &quot;)&quot;),
                                     1:12)</code></pre>
<pre class="r"><code>errors |&gt; 
  _[measure == &quot;iiee&quot;] |&gt;
  _[obs_dataset == which_dataset] |&gt;
  # _[, month := lubridate::month(time_forecast, label = TRUE)]  |&gt; 
  _[, median_ci(value), 
    by = .(lag, version, measure, obs_dataset, month(time_forecast))] |&gt; 
  ggplot(aes(lag, mid)) +
  
  geom_vline(data = month_from_lag(1, 1), aes(xintercept = lag), 
             colour = &quot;gray50&quot;, linewidth = 0.1) +
  
  geom_text(data = month_from_lag(15, 1), aes(y = Inf, label = month2), 
            size = 2.5,
            vjust = 1) +
  
  geom_text(data = month_from_lag(1, 1), aes(y = -Inf, label = lag), 
            size = 2.5,
            vjust = 0) +
  
  geom_ribbon(aes(ymin = low, 
                  ymax = high, 
                  color = version, 
                  fill = version), alpha = 0.1) +
  geom_line(aes(color = version), linewidth = 1) +
  
  
  # geom_errorbar(data = \(x) x[dif, on = .NATURAL][version == &quot;S1&quot;], 
  #              aes(x = lag, 
  #                  ymin = mid - (high - low), ymax = mid + (high - low))) +
  
  # geom_point(data = \(x) x[dif, on = .NATURAL][version == &quot;S1&quot;],
  # aes(lag, mid), size = 3, shape = 21) +
  
  
  scale_y_continuous(labels = labels_extent) +
  scale_x_continuous(breaks = NULL, expand = c(0, 0)) +
  scale_color_models +
  scale_fill_models +
  labs(y = NULL, 
       x = &quot;Lag&quot;) +
  #   scale_color_models +
  #   scale_fill_models +
  facet_wrap(~ month, labeller = labeller(month = labels_month_significant)) </code></pre>
<div class="figure">
<img src="poster_figures_files/figure-html/fig-iiee-1.png" alt="Median and 95% coverage of Integrated Ice Edge Error as a function of forecast lag for all forecast initialised on the first of each month for +S1 and +S2 hindcasts. For each month, the number in parenthesis indicates the minimum lag at which the the mean error of each model is not statistically significant at a 1% level using a two-sisded t-test." width="1475.84" />
<p class="caption">
Median and 95% coverage of Integrated Ice Edge Error as a function of
forecast lag for all forecast initialised on the first of each month for
+S1 and +S2 hindcasts. For each month, the number in parenthesis
indicates the minimum lag at which the the mean error of each model is
not statistically significant at a 1% level using a two-sisded t-test.
</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
